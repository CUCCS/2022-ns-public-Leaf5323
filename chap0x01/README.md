# åŸºäºVirtualBoxçš„ç½‘ç»œæ”»é˜²åŸºç¡€ç¯å¢ƒæ­å»º

## å®éªŒç¯å¢ƒ

- Host Machine

  - Windows 11 22H2 build 22622.590

- Virtual Machine Platform

  - VirtualBox 6.1.38 r153438

- Guest Machine

  - Attacker:
  
    - attacker-kali: Kali 2022.3 kali-rolling

  - Gateway:
  
    - gateway-debian: Debian 10 buster

  - Victim:

    - victim-kali: Kali 2022.3 kali-rolling

    - victim-xp-1: Windows xp 5.1 build 2600.xpsp.080413-2111:ServicePack3

    - victim-debian: Debian 10 buster

    - victim-xp-2: Windows xp 5.1 build 2600.xpsp.080413-2111:ServicePack3

## å®éªŒè¦æ±‚

- [x] è™šæ‹Ÿç¡¬ç›˜é…ç½®æˆå¤šé‡åŠ è½½ï¼Œæ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

  ![image](./img/vb-multi-attach.png)

- [x] æ­å»ºæ»¡è¶³å¦‚ä¸‹æ‹“æ‰‘å›¾æ‰€ç¤ºçš„è™šæ‹Ÿæœºç½‘ç»œæ‹“æ‰‘

  ![image](./img/vb-exp-layout.png)

- å®Œæˆä»¥ä¸‹ç½‘ç»œè¿é€šæ€§æµ‹è¯•ï¼š

  - [x] é¶æœºå¯ä»¥ç›´æ¥è®¿é—®æ”»å‡»è€…ä¸»æœº

  - [x] æ”»å‡»è€…ä¸»æœºæ— æ³•ç›´æ¥è®¿é—®é¶æœº

  - [x] ç½‘å…³å¯ä»¥ç›´æ¥è®¿é—®æ”»å‡»è€…ä¸»æœºå’Œé¶æœº

  - [x] é¶æœºçš„æ‰€æœ‰å¯¹å¤–ä¸Šä¸‹è¡Œæµé‡å¿…é¡»ç»è¿‡ç½‘å…³

  - [x] æ‰€æœ‰èŠ‚ç‚¹å‡å¯ä»¥è®¿é—®äº’è”ç½‘

## å®éªŒè¿‡ç¨‹è®°å½•

### Guest Machine Configuration

#### Multiattach Set Up

é¦–å…ˆä»æ¥æ²¡æœ‰å¬è¯´è¿‡`å¤šé‡åŠ è½½`è¿™ä¸ªåè¯ï¼ŒçœŸç™½ç©äº†é‚£ä¹ˆä¹…è™šæ‹Ÿæœºï¼Œç”±äºä¸ç¡®å®šç¿»è¯‘äºæ˜¯ç”¨ç›´æ¥å’•å’•å™œä¸­æ–‡`virtualbox å¤šé‡åŠ è½½`ï¼Œç„¶åé€šè¿‡æŸä¸ªæœç´¢ç»“æœè¿›å…¥çš„åšå®¢è½¬è½½é¡µé¢æ‰¾åˆ°äº†CSDNçš„åŸæ–‡ğŸ˜“ï¼Œäº†è§£äº†ä¸€ä¸‹æ“ä½œæµç¨‹ï¼Œå¤§è‡´åˆ†ä¸ºä»¥ä¸‹ä¸¤æ­¥ï¼š

1. åœ¨VirtualBoxèœå•æ ä¸­çš„`ç®¡ç†`>`è™šæ‹Ÿä»‹è´¨ç®¡ç†`ä¸­æ‰¾åˆ°ç›®æ ‡ä»‹è´¨

2. é€‰ä¸­ç›®æ ‡ä»‹è´¨ï¼Œå¦‚æœä»‹è´¨å·²è¢«åˆ†é…åˆ™éœ€è¦å…ˆç‚¹å‡»`é‡Šæ”¾`ï¼Œæ­¤æ—¶ä¼šæé†’å°†ä»‹è´¨ä»æ·»åŠ åˆ°çš„è™šæ‹Ÿæœºç§»é™¤ï¼Œç¡®è®¤åå†ç‚¹å‡»`å±æ€§`åˆ‡æ¢å‡ºçª—å£ä¸‹æ–¹çš„å±æ€§é¡µé¢ï¼Œåœ¨`ç±»å‹`é€‰å•å†…é€‰æ‹©å¤šé‡åŠ è½½ååœ¨å³ä¸‹è§’ç‚¹å‡»åº”ç”¨å³å¯ï¼›å¦‚æœæ²¡æœ‰è¢«åˆ†é…åˆ™ç›´æ¥å¯ä»¥åœ¨å±æ€§é¡µé¢å†…ç›´æ¥é€‰æ‹©ç±»å‹å¹¶åº”ç”¨

å¦‚æ˜¯è¿›è¡Œæ“ä½œä¹‹åå¾ˆè½»æ¾åœ°å°†æ”»å‡»è€…ä¸»æœºã€ç½‘å…³å’Œ4å°é¶æœºçš„ç£ç›˜é…ç½®äº†å¤šé‡åŠ è½½ï¼Œæ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![screenShot](./img/kaliMultiattach.png)

![screenShot](./img/debianMultiattach.png)

![screenShot](./img/xpMultiattach.png)

æ˜¾ç„¶æˆ‘ä»¬æœ‰6å°è™šæ‹Ÿæœºä½†åªæ”¾äº†3å¼ æˆªå›¾ï¼Œä¸»è¦æ˜¯è€ƒè™‘åˆ°å¤šé‡åŠ è½½çš„ç‰¹æ€§ï¼ŒCSDNçš„é‚£ç¯‡æ–‡ç« è¯´å®è¯æˆ‘æ²¡çœ‹å¤ªæ‡‚ï¼Œä½†å¤§æ¦‚ç†è§£åˆ°å¤šé‡åŠ è½½çš„æ„æ€å°±æ˜¯

>å¯ä»¥ä½¿æ­¤ç±»å‹çš„ç£ç›˜ä»‹è´¨æ‹¥æœ‰â€œåœ¨æŸä¸ªæ—¶é—´ç‚¹ä¸Šï¼Œè¢«æ–°å»ºçš„ç›¸åŒç³»ç»Ÿçš„è™šæ‹Ÿæœºç›´æ¥ä½¿ç”¨ï¼Œä¾¿å¯å¤åˆ¶å‡ºè¿™ä¸ªæ—¶é—´ç‚¹ä¸Šçš„æ—§çš„ç›¸åŒç³»ç»Ÿçš„è™šæ‹Ÿæœºâ€çš„èƒ½åŠ›

è¯´ç™½äº†æœ‰ç‚¹åƒæ ‘ï¼Œå¤šé‡åŠ è½½çš„ç£ç›˜ä»‹è´¨æ¯è¢«æ–°å»ºçš„è™šæ‹Ÿæœºç›´æ¥å¼•ç”¨å°±ä¼šå¤šä¸€ä¸ªå½“å‰æ—¶é—´ç‚¹çš„å­èŠ‚ç‚¹ğŸ¤”

æ‰€ä»¥å‰©ä½™çš„ç›¸åŒç³»ç»Ÿå‡æ˜¯ç”±åŒä¸€ç£ç›˜ä»‹è´¨å¤åˆ¶å‡ºæ¥çš„ï¼Œè‡ªç„¶ä¹Ÿä¸éœ€è¦é‚£ä¹ˆå¤šæˆªå›¾ï¼ˆè‡ªä¿¡ï¼‰

è®²é“ç†ä¸‡ä¸€é”™äº†å°±å¾ˆå°´å°¬ğŸ˜‚ï¼Œæ‰€ä»¥ä¸ºäº†ä¿é™©èµ·è§æˆ‘ä¸“é—¨å»æŸ¥äº†VirtualBoxçš„æ–‡æ¡£ï¼Œè€Œé‡Œé¢çš„è§£é‡Šé€šä¿—æ˜“æ‡‚ï¼Œæ°å¥½æ˜¯æˆ‘ç†è§£çš„æ„æ€ï¼ŒåŸæ–‡æ˜¯è¿™æ ·è¯´çš„ï¼š

>Multiattach mode images can be attached to more than one virtual machine at the same time, even if these machines are running simultaneously. For each virtual machine to which such an image is attached, a differencing image is created. As a result, data that is written to such a virtual disk by one machine is not seen by the other machines to which the image is attached. Each machine creates its own write history of the multiattach image.

å°±ä¸ç¿»è¯‘äº†ï¼Œæ€»ä¹‹æˆ‘ç†è§£çš„æ²¡é”™ï¼ŒåŒæ—¶å†åæ§½ä¸€ä¸‹CSDNä¸Šçš„æ–‡ç« çœŸçš„ä¸€è¨€éš¾å°½

#### è™šæ‹Ÿæœºç½‘ç»œæ‹“æ‰‘æ­å»º

è¿™é‡Œå…¶å®ä¸å¤ªéš¾ç†è§£ï¼Œåœ¨å®Œæˆä¸Šä¸€æ­¥çš„å†…å®¹æ—¶å·²ç»å°±é¡ºæ‰‹æŠŠç½‘å¡ç»™åˆ†é…äº†ï¼Œè¿˜æ˜¯æŒ‰å›¾è¯´è¯ï¼š

![image](./img/vb-exp-layout.png)

é¦–å…ˆå›¾ç‰‡é‡Œé¢æœ‰ä¸¤ä¸ª`å†…éƒ¨ç½‘ç»œ`ï¼Œé‡Œé¢åˆ†åˆ«æœ‰ä¸¤å°ç³»ç»Ÿä¸ä¸€æ ·çš„é¶æœºï¼Œæˆ‘æ²¡æœ‰æ“…è‡ªä¿®æ”¹å¤ªå¤šï¼Œç›´æ¥ç…§ç€å›¾è¿›è¡Œæ‘†æ”¾ï¼Œæ„Ÿè§‰æœ‰ç‚¹åƒç”¨å¤æ‚åŒ–çš„Packet Tracerï¼Œåªèƒ½é€šè¿‡æ‰‹åŠ¨è®¾ç½®ç½‘å¡æ¥åˆ’åˆ†å­ç½‘çš„é‚£ç§ğŸ¤”

å›¾ä¸Šå·¦ä¾§é»„è‰²éƒ¨åˆ†çš„`Internal Network 1`æˆ‘åœ¨VirtualBoxç½‘å¡é…ç½®æ—¶ç»™çš„åç§°ä¸º`intnet0`ï¼Œå³ä¸Šä¾§ç°è‰²çš„`Internal Network 2`åˆ™æ˜¯è¢«æˆ‘é…ç½®ä¸º`intnet1`ï¼Œä¸¤ä¸ªå†…éƒ¨ç½‘ç»œä¸­çš„é¶æœºåˆ†åˆ«ä»…é…ç½®ä¸€å¼ `å†…éƒ¨ç½‘ç»œ`è¿æ¥æ–¹å¼çš„ç½‘å¡ï¼Œç½‘ç»œåç§°åˆ†åˆ«è®¾ç½®ä¸ºå¯¹åº”å†…ç½‘çš„åç§°ï¼Œäºæ˜¯ä¸¤ä¸ªå†…ç½‘é¦–å…ˆè®¾ç½®å®Œæ¯•

ç„¶åæ˜¯ç½‘å…³éƒ¨åˆ†ï¼Œä¸Šè¯¾æ—¶å¿«é€Ÿè®°å¿†ä¸‹æ¥äº†ç½‘å…³æ‰€éœ€çš„4å¼ ç½‘å¡çš„é…ç½®æ–¹å¼ï¼Œè¿™é‡Œç›´æ¥é…ç½®ï¼š

- ç½‘å¡1ï¼šNATè¿æ¥æ–¹å¼ï¼Œç”¨äºè¿æ¥å¤–ç½‘

- ç½‘å¡2ï¼šHost-Onlyç½‘ç»œï¼Œç”¨äºå®¿ä¸»æœºSSHè¿æ¥

- ç½‘å¡3ï¼šå†…éƒ¨ç½‘ç»œ`intnet0`ï¼Œç”¨äºè·¯ç”±`Internal Network 1`

- ç½‘å¡4ï¼šå†…éƒ¨ç½‘ç»œ`intnet1`ï¼Œç”¨äºè·¯ç”±`Internal Network 2`

æœ€åæ˜¯æ”»å‡»è€…ä¸»æœºéƒ¨åˆ†ï¼Œè¿™ä¸ªæ˜¾ç„¶æ˜¯åªè¿æ¥äº†å¤–ç½‘æ‰€ä»¥åªéœ€è¦é…ç½®ä¸€å¼ NATæ–¹å¼çš„ç½‘å¡å³å¯

## æ€»ç»“

## å‚è€ƒé“¾æ¥

- [Virtualbox å¤šé‡åŠ è½½ é«˜çº§åŠŸèƒ½ä»‹ç»](https://blog.csdn.net/Jeanphorn/article/details/45056251)

- [Chapter 5. Virtual Storage](https://www.virtualbox.org/manual/ch05.html)
